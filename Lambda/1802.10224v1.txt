Translucent windows:  how uncertainty in competitive interactionsimpacts detection of community patternRafael D’Andrea1,∗, Annette Ostling2,∗∗& James O’Dwyer1,†1Dept. Plant Biology, University of Illinois at Urbana-Champaign, IL, USA2Dept. Ecology & Evolutionary Biology, University of Michigan, Ann Arbor, MI, USA∗rdandrea@illinois.edu,ORCID 0000-0001-9687-6178∗∗aostling@umich.edu,†jodwyer@illinois.eduAbstractTrait variation and similarity among coexisting species can provide a window into the mecha-nisms that maintain their coexistence.  Recent theoretical explorations suggest that competitiveinteractions will lead to groups, or clusters, of species with similar traits.  However, theoreticalpredictions typically assume complete knowledge of the map between competition and measuredtraits.  These assumptions limit the plausible application of these patterns for inferring compet-itive interactions in nature.  Here we relax these restrictions and find that the clustering patternis robust to contributions of unknown or unobserved niche axes.  However, it may not be visibleunless measured traits are close proxies for niche strategies.  We conclude that patterns alongsingle niche axes may reveal properties of interspecific competition in nature, but detecting thesepatterns requires natural history expertise firmly tying traits to niches.Keywords:Community  structure,  Competition,  Functional  traits,  Noise,  Uncertainty,  Self-organized similarity, Species clusters, Trait patternCorresponding author:  Rafael D’Andrea, rdandrea@illinois.edu, (631) 645-5710, 172 MorrillHall 505 S Goodwin Ave, Urbana, IL, 61801Data accessibility statement: This study made use of simulations.  The code to generate andanalyze the data is available on GitHub, https://github.com/rafaeldandrea/Translucent-windows-2018-code.Statement of Authorship:  RD, AO, and JD conceived the study.  RD performed modelingwork and analyzed output data.  RD wrote the first draft of the manuscript, and all authors con-tributed substantially to revisions.This is the peer reviewed version of the following article: “Translucent windows:how uncertainty in competitive interactions impacts detection of community pattern”,which has been accepted for publication at Ecology Letters, DOI: 10.1111/ele.12946.This article may be used for non-commercial purposes in accordance with Wiley Termsand Conditions for Self-Archiving.1arXiv:1802.10224v1  [q-bio.PE]  28 Feb 2018IntroductionHow does competition shape the distribution of species traits in nature?  The classic answer, basedon  the  idea  that  similarity  breeds  competition,  is  that  coexisting  species  will  be  more  differentthan expected by chance (MacArthur and Levins, 1967; Abrams, 1983).  Although intuitive, thisprediction  of  limiting  similarity  lacks  widespread  empirical  support  (Chase  and  Leibold,  2003;G ̈otzenberger et al., 2012) despite extensive research (D’Andrea and Ostling, 2016).  Recent studieshave found that trait-mediated competition can actually lead to the emergence of clusters, or groupsof similar species (Bonsall et al., 2004; Scheffer and van Nes, 2006; Hern ́andez-Garc ́ıa et al., 2009;Sakavara  et  al.,  2018).   Although  contradictory  on  the  surface,  clusters  are  a  natural  extensionof  limiting  similarity.   If  left  alone,  competitive  sorting  culminates  in  maximally  differentiatedspecies, each occupying a niche.  But an influx of new individuals and species due to speciation orimmigration may keep the number of extant species above the number of local niches (D’Andreaet al., 2018).  In that case, species whose traits place them near a niche will persist longer (Scrantonand Vasseur, 2016; D’Andrea and Ostling, 2017), and species in between are quickly excluded as theyare not well adapted to any niche (Barab ́as et al., 2013; Vergnon et al., 2013).  The incorporation ofspecies clusters to traditional trait-pattern theory may help explain the mixed evidence for limitingsimilarity, and may help understand coexistence in species-rich systems such as tropical forests.Nevertheless, clusters are not a widely observed phenomenon in nature outside specific commu-nities (Scheffer and van Nes, 2006; Scheffer et al., 2015; Segura et al., 2011, 2013; Vergnon et al.,2009; Yan et al., 2012).  While this can in part be due to clusters having only recently been con-nected with competition in the theoretical literature (D’Andrea and Ostling, 2016), it is not clearthat clusters should occur outside idealized models.  Theoretical studies typically make two criticalassumptions  that  do  not  hold  in  real  communities,  thus  limiting  their  applicability.   First,  theyassume that species can be arranged on a line such that distances between their relative positionson the line determine how strongly they compete with one another (MacArthur and Levins, 1967).In reality, it is unlikely that positions along a single line can fully predict the degree of competition.For  example,  birds  that  eat  very  distinct  foods  may  still  compete  strongly  for  nesting  sites,  ormay be under apparent competition because they share predators or parasites.  Knowledge of thebirds’ diets will predict degree of competition better than chance, but the relationship will appearnoisy because of the contribution of these other factors.  In this study we will refer to the line asa niche axis, such that separation on that axis predicts the degree of competition between species.From the vantage point of the food-niche axis, the unknown contributions of the nesting site axis,predator axis, etc loosen the link between diet and competition.  While there is theoretical evidencethat multidimensional niche space may cause multidimensional niche clustering (Fort et al., 2010),it is unclear whether any pattern should be expected along a single niche axis in the presence ofthese other unobserved factors.The second assumption is that measurable traits such as body size and leaf tissue density areactual niche axes, so patterns driven by competition should be visible as patterns in the distributionof these traits.  However, there is a conceptual distinction between aspects of phenotype directlyresponsible  for  competitive  interactions  and  aspects  of  phenotype  that  are  typically  measured.The  former  may  form  niche  axes,  but  are  unlikely  to  perfectly  coincide  with  easily  measurablemorphological or physiological traits (Appendix A). At best, measured functional traits are goodpredictors of the true causes of competitive interactions (McGill et al., 2006; Violle et al., 2007),but that map is inevitably noisy.  For example,  consider plant strategies regarding light captureand shade tolerance, or the “light-niche” axis.  Leaf tissue density correlates with shade tolerancein forests, but will not fully predict the light-niche because the latter is also affected by many otherplant traits, such as maximum plant height and wood density (Wright et al., 2010).  Pattern in the2distribution of light strategies across species will translate into pattern in the distribution of leaftissue density only to the extent that the latter reflects the former.Little is known about how this inevitable uncertainty might affect our ability to detect patternin nature (Fig. 1).  If the clusters predicted by theory are robust to uncertainty, then they are usefulfor diagnosing competition based on overlap in niche strategies.  But if measuring an incompleteor  inaccurate  set  of  traits  means  we  are  unlikely  to  detect  clusters,  then  there  is  little  value  insearching for them in nature.Figure 1: Causal links between traits and community structure.  In nature (top), the full set offunctional traits completely determines strategies in niche space; the latter in turn consists of multiple nicheaxes, the full set of which completely determines the competitive interactions between species; competitiondrives clustering in niche space, which translates as measurable clustering in trait space.  A complete modelof nature would require impossibly complete knowledge and measurement of all the relevant elements andlinks.   An  effective  model  (bottom)  focuses  on  a  subset  of  trait  and  niche  axes,  and  treats  the  unmea-sured/unmodeled  contribution  of  all  other  factors  as  noise.   As  an  example,  we  show  an  effective  modelwhere a single niche axis (light-related strategy) is an imperfect predictor of competitive interactions, withthe unknown contribution of all other niche axes comprising process noise; in turn, a single functional trait(maximum height) is an imperfect predictor of the light-niche strategy, and the unknown contribution of allother functional traits enters as measurement noise.Maximum heightWood densitySeed massEtc...LightWaterHerbivoresCompetitionClusteringEtc...determinesdrivesdetermines+Measurement noiseMaximum heightWood densitySeed massEtc...+Process noiseLightWaterHerbivoresEtc...CompetitionClusteringdrivespredictspredictsFull trait spaceFull niche spaceNATUREEFFECTIVE  MODELEcological forcePatternMeasured traitModeled nicheEcological forcePatternHere  we  test  this  robustness.   We  start  by  asking  what  happens  when  only  one  of  the  nicheaxes  responsible  for  competitive  interactions  is  fully  known.   We  find  that  pattern  on  one  nicheaxis is surprisingly robust to the contributions of other niche axes.  Next we ask whether this nichepattern translates well into trait pattern, given that traits are imperfect predictors of niches.  Wefind that the pattern is quite sensitive to this error, and its detectability quickly fades as we loosenthe  link  between  niche  axis  and  measured  trait.   We  then  show  that  measuring  multiple  traitscan provide more accurate estimates and thus reduce measurement noise, but ultimately a tightfunctional relation between traits and niche strategies is key.3Materials and MethodsNiche dynamicsMany ecological communities consist of multiple species competing for resources, and often theseresources are thought of as falling on a continuous gradient.  One such example is seed-eating birdsthat may feed on seeds of various sizes.  The species niche reflects its resource preferences within thegradient, so that similarity in niche values denotes the amount of overlap between those strategies(MacArthur and Levins, 1967; Leimar et al., 2013).We represent this scenario using a Lotka-Volterra model of competitive dynamics.dNidt=ri1−∑jAijNjKiNi+miwhereNi,ri,Kiare the abundance, intrinsic (maximal) growth rate, and carrying capacity of speciesi, and the competition coefficientsAijquantify the per-capita competitive impact of speciesjonspeciesi.  Steady immigrationmimaintains all abundances above zero.We useS= 200 species in our simulations, and let species differ only by niche strategy, affectingAij.  We set parametersr= 1,K= 100, andm= 0.2 immigrating individuals per species per year,identical across all species.  These parameter choices lead to equilibrium community sizes between600 and 35,000 individuals.  As a reference point, the 50-hectare forest plot in Barro Colorado Islandhas approximately 300 species, 20,000 trees, and an estimatedm= 0.1 immigration event per birth(Hubbell, 2001).  We verified that our results are robust to a four-fold change in immigration rates.All simulations are performed using library deSolve in the R language (R Core Team, 2017).Competition coefficients—the kernelWe will refer to the matrix of competition coefficientsAijas the competition kernel, by analogywith continuous formulations.  We setAij=a0exp(−d4ij)wheredijis the distance in niche space between speciesiandj, and the scaling factora0is someconstant.  This quartic function is a generic monotonic shape commonly used in competition models(Pigolotti et al., 2010; Leimar et al., 2013).  A plot of this function reveals two distinct zones:  aplateau  of  intense  competition  between  similar  species,  and  a  steep  drop-off  beyond  a  thresholdniche distance (Fig. S3A). We refer to the inner region as the “core” of the kernel, and the outerregion as its “tail”.  As we will show, this core-tail structure is instrumental in pattern-formation.The threshold distance is somewhat arbitrary, and here we take it to be the niche distance wherethe kernel is equal to its mean value.  Other choices do not qualitatively change our results.Process noise:  competition in two-dimensional niche spaceConsider  a  case  where  competitive  interactions  are  collectively  determined  by  species  strategiesalong two niche axes, e.g.  two different types of resources such as food and nesting sites, or twodifferent types of food such as seeds and insects.  Suppose also we only have access to one suchaxis.  The contributions of the unknown niche axis add randomness (i.e.  noise) to the otherwisemonotonic relationship between competition kernel and niche differences on the known axis (Fig. 2).We call thisprocess noise.4Figure 2: Hidden niche dimensions add process noise; imperfect traits add measurement noise.Process  noiseA: Hypothetical niche space formed by two complementary niche axes, with species labeledin order of Euclidean xy-distance to the black species.B: Intensity of competition with black species hasa  monotonic  relationship  with  the  two-dimensional  distance.C:  Positions  of  the  same  species  along  thex-niche axis, with species labeled in order of x-distance to black.D: Plot of competitive interactions withblack as a function of x-distance shows a non-monotonic relationship.  The mismatch between B and D isprocess noise, which is commensurate with the relative importance of the unknown contributions of the y-niche.Measurement noiseE: Measured traits estimate unseen niche strategies, but the map is imperfect, andrelative positions may switch between niche and trait axes.F: Arranging species in increasing order of niche-distance to species 1 gives a monotonic relationship with competition.G: Arranging species in increasingorder of trait-distance to species 1 yields an overall decreasing but noisy relationship.  The mismatch betweenF and G is measurement noise, which is commensurate with the imperfections in the niche-trait map.lllllxyAx−nichey−nicheABDECClllllx−niche12345lllllsort(d2)sort(A2, decreasing = TRUE)Bxy−distance to blackCompetition with blackABCDEd1A1lllllDx−distance to blackCompetition with black123450EllllllllllllllllllABCDEFGHI142367598Trait axisNiche axisllllllllldnAFABCDEFGHINiche distance to ACompetition with AlllllllllAG142367598Trait distance to 1Competition with 1Measurement noiseProcess noise5Two different niche axes can interact in various ways to determine niche overlap (Holt, 1987).For example, the two niche axes may reflect strategies for acquiring complementary resources.  Inthis case, similarity on one niche axis (e.g.  similar preferences in insect prey) can be compensatedvia differences along the other axis (foraging for very different seeds).  Alternatively, the niche axesmay represent fundamentally different needs such as food and nesting sites for birds, or water andlight for plants. In this case, no amount of niche differences on one axis can compensate for similarityon the other.  We term these scenarios complementary and essential niche axes, respectively.In  our  model,  these  different  scenarios  define  the  two-dimensional  niche  separation  betweenspecies.  In the case of complementary niche axes, we setdij=√(xi−xjwx)2+(yi−yjwy)2wherexi(xj) is the x-niche strategy of speciesi(j), which can range from 0 to 1,wxis a scalingfactor that weighs the x-niche difference relative to the y-niche difference, and vice-versa for y-basedparameters.  Notice that if niche differences on either axis are large,dijwill be large, and thereforethe competition coefficient will be small, regardless of differences on the other.In the essential niche axes case, we setdij= min(∣∣∣∣xi−xjwx∣∣∣∣,∣∣∣∣yi−yjwy∣∣∣∣)In this case,dijwill be small if either the x- or y-niche separation is small, regardless of how largethe other niche separation may be.  Here species cannot compensate for similarity on one axis bydissimilarity on another, and the limiting resource is the one for which they compete the most.The  constantswxandwydefine  the  relative  weight  of  each  niche  axis  to  the  overall  nicheseparation.  In the complementary niche axes scenario, the y-contribution vanishes whenwyis verylarge relative towx, and dominates the coefficient when it is very small.  In the essential niche axesscenario, the reverse is true.  If we can measure the x-niche strategies of our species but have noaccess to the y-niche, we anticipate that pattern on the x-axis should be likely to the extent thatthe x-niche dominates competitive interactions—i.e.  when the process noise from the perspectiveof the x-niche is sufficiently low.  To quantify this, we fixwx= 0.1, and test the x-axis for speciesclustering as we dialwyup or down.Species x- and y-niche values are drawn from a uniform distribution between 0 and 1, with thelatter being redrawn for every new run.  We simulate 100 replicates of each scenario to ensure thatresults are robust. In each replicate we tune the scaling factora0to ensure that the community-wideaverage intensity of competition is the same in all our simulations.Lotka-Volterra  equations  approximate  more  complex  dynamics  near  equilibrium  (Schoener,1974,  1976),  hence  their  widespread  use  in  ecological  theory.   However,  true  consumer-resourceinteractions do not map trivially onto niche differences.  We therefore tested our approach againstmodels where species dynamics are explicitly based on their use of resources.  Rather than prescribethe competition coefficients, we obtain them from simulation outcomes of the model, and then com-pare with distances in niche space.  In Appendix B we present a resource-consumer model with twotypes  of  essential  resources,  such  as  different  nutrients.   The  results  confirm  that  the  minimumniche distance is a good predictor of pairwise competitive impacts.  In Appendix C we present amodel of complementary niche axes:  plants compete for space in a heterogeneous landscape, andhigh  competition  due  to  similar  affinity  for  one  environmental  property  (e.g.   humidity)  can  becompensated by dissimilar affinities for another property (e.g.  salinity).  Results confirm that theEuclidean niche distance accurately predicts competitive interactions.6Measurement noiseEven if niche space consists of a single niche axis, niche axes are typically not directly measurable;traits are.  Whether clustering on a niche axis (e.g. competence in acquiring and processing light)translates as clustering on a measurable trait axis (e.g. maximum height) depends on how closeis  the  relation  between  the  trait  and  the  niche  axis  (Fig.  2).   We  call  the  noise  in  this  relationmeasurement noise.To examine the impact of this type of noise, here we assume a simpler niche space than above,consisting of a single niche axis.  The niche axis fully determines competitive interactions (i.e. thereis no process noise),  and we now assume that competition coefficients are monotonically tied toniche differences.  This leads to strong clustering along the niche axis.Knowing that the niche axis is clustered, we want to assess the probability of clustering alonga  measurable  trait  axis,  given  that  the  trait  is  statistically  associated  with  the  niche.   We  thenarrange species on a proxy trait axis such that trait values are random variables correlated withthe niche values (Fig. 5A-D). Because of measurement noise, species relative positions on the nicheaxis will not be entirely preserved on the trait axis.  As a result, competition will not be a strictlymonotonic function of trait separation (Fig. 5E-H), and the clustered niche pattern will be somewhatrandomized on the trait axis.  Mathematically,  we writeti=xi+εi,  wheretiis the trait valueof speciesi,xiis its niche value,  andεiis the measurement noise between the two.  Theεiarenormally distributed random variables with mean 0 and whose variance determines the magnitudeof the noise.  Note that trait noise does not affect species dynamics, as the noise here is at the levelof how we measure species and not at the level of their interactions.Using multiple traits to mitigate measurement noiseIn nature, a single niche axis will correlate with multiple trait axes.  For example, niche strategyregarding competition for light in forests will reflect on specific leaf area, leaf nitrogen content, twiglength, maximum plant height, etc.  Individually, each trait will be an imperfect predictor of thespecies’ light-related niche strategy, but together they may provide a better estimate.  Combiningmultiple traits associated with the same niche axis may lead to a better estimate of the true nichevalues, and therefore clustering that is lost on any individual trait axis may appear on an aggregateaxis.We test this idea using a simulated set ofnproxy traits, and their first principal component asthe aggregate axis.  The trait valuetaiof speciesion trait axisa(i= 1,2,...,200;a= 1,2,...,n)is a random variable linearly related to its niche valuexi.  We then writetai=baxi+ca+εai, wherebaandcaare constants specific to trait axisaandεaiis the measurement noise, which is normallydistributed with mean 0 and varianceσ2a.  This variance can be different for different trait axes, asthe niche axis may be more tightly linked to some traits than others—e.g.  the light-niche may bemore directly influenced by maximum height than wood density.Although we write the trait as a function of the niche, we are not assuming the latter determinesthe former, but merely that they are correlated (see discussion in Appendix E). We also distinguishbetween  multidimensional  niche  space  and  the  present  scenario  of  a  one-dimensional  niche  axisthat  maps  to  multiple  traits.   An  example  of  the  former  is  competition  based  on  the  combinedoverlap  in  strategies  for  capturing  light  and  strategies  for  acquiring  water,  whereas  an  exampleof  the  latter  is  when  the  light-niche  strategy  fully  determines  competitive  interactions  (possiblybecause all species involved have identical strategies in all other niche axes), and maps to varioustraits  such  as  maximum  height  and  specific  leaf  area.   Finally,  we  note  that  our  multiple  traitscorrelate with each other through their association with the niche strategy, as is common in nature7(Litchman and Klausmeier, 2008; Wright et al., 2010; Shoval et al., 2012), but we are assuming nofurther correlation between these traits.  This leads to the best-case-scenario where every new traitadds maximal information about the niche; were there any further correlations between the traits,new traits added to the analysis could be partially predicted by the existing ones, and therefore wewould gain less information by incorporating them.Quantifying the noiseWithout  process  or  measurement  noise,  competition  will  be  strong  between  similar  species,  andweak between dissimilar ones.  We therefore quantify noise as the degree of departure from thisideal scenario.  We do so using two summary statistics.Spearman’s  rank  correlation  coefficient,ρ(A,d),  quantifies  the  degree  to  which  competitioncoefficients are monotonically related to pairwise distances on the niche or trait axis (McDonald,2009).  The index ranges from−1 (perfectly monotonic relationship) to 0 (no relationship).As noted above, the kernel has a core (competition coefficients of species with small niche ortrait  differences)  and  a  tail  (large  differences).   We  quantify  the  degree  to  which  this  core-tailstructure predicts competitive relations by calculating the difference in proportion of tail and coreelements  that  are  greater  than  the  kernel  mean,π(A)  =P(Atail>A)−P(Acore>A).   In  thenoise-free scenario, the first proportion is 0 and the second is 1, leading to a difference of−1, whilein a completely random matrix both proportions are the same and the expected difference is 0.As  these  metrics  put  both  process  and  measurement  noise  in  the same footing  as  degrees  ofkernel disorder, they allow comparison of the relative impact of each.Quantifying clusteringTo determine whether or not a species assemblage is clustered,  we use a metric based on the k-means clustering algorithm and the gap statistic method (MacQueen, 1967; Tibshirani et al., 2001).The metric takes into account the niche or trait values of each species as well as their abundances,and estimates the number of clusters that best fits our species assemblage by comparing each fitagainst randomized null assemblages.  The fit itself is based on pairwise distances along the nicheor  trait  axis  between  all  species  in  the  community,  weighted  by  their  abundances  (we  representeach species by its average niche/trait value).  Upon comparing results between the assemblage ofinterest and the null assemblages, we obtain a z-score and a p-value, which tell us the degree towhich the assemblage is clustered, and whether the result is statistically significant.  We providethe mathematical details of the metric in Appendix F.ResultsBriefly, we found that the kernel’s core-tail structure is key for pattern emergence, and the clusteringpattern is robust to a substantial amount of noise between competition and niche strategies (processnoise).  On the other hand, clustering is sensitive to noise between niche strategies and measuredtrait values (measurement noise);  this is because measurement noise effectively reshuffles speciesalong the axis, thus randomizing the community.  Finally, a large set of functional traits may helpcircumvent the issue, as combined they serve as a more accurate window into the biological nichethan an individual trait is likely to be.8Figure 3: Process noise.A, D: Competition coefficients between a focal species and all other species,plotted against the difference in x-niche values.  Although competition strictly declines with distances in thexy-niche plane, the relationship with x-niche differences alone is noisy.  In the complementary niche axes case(A), most of that noise is between similar species—i.e.  the core of the kernel.  Conversely, in the essentialniche axes case (D), most of the noise is between distinct species—i.e.  the tail of the kernel.B, E: Simulationoutcomes plotted in the xy-niche plane.  Each disk represents a species, with disk size proportional to speciesabundance.  In both the complementary niche axes case (B) and the essential niche axes case (E), there isstrong clustering, as evidenced by the standardized magnitude of the clustering metric (Z in the legend) andthe significant p-value (P).C, F: Same outcomes plotted on the x-niche axis only, with loss of the y-niche.Clustering is still visible, although the number of clusters is smaller because some distinct clusters cannotbe resolved without the y-dimension.  Notice also the lower magnitude of the clustering metric.llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.51.01.52.0x−niche differenceCompetition coefficientA0.00.20.40.60.81.00.00.20.40.60.81.0x−nichey−nicheK = 21Z = 4.1P < 0.01B0.00.20.40.60.81.0051015202530x−nicheSpecies abundanceK = 16Z = 3.5P < 0.01Cllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.10.20.30.40.5x−niche differenceCompetition coefficientD0.00.20.40.60.81.00.00.20.40.60.81.0x−nichey−nicheK = 7Z = 7.1P < 0.01E0.00.20.40.60.81.0051015202530x−nicheSpecies abundanceK = 6Z = 3.4P < 0.01FKernelPattern in xy − niche planePattern on x − niche axisEssentialniche axesComplementaryniche axesProcess noiseFig. 3 shows an example of each kind of process noise.  In the complementary niche axes case, thenoise is concentrated in the core of the kernel (Fig. 3A). In other words, competition is consistentlylow  at  large  x-niche  distances,  but  noisy  at  small  distances.   This  is  because  some  species  pairsat short x-niche distances are far apart on the y-niche axis, thus bringing down the competitioncoefficient which would otherwise be high.  Our clustering metric confirms that species are distinctlyclustered in the xy-niche plane (Fig. 3B), as expected.  However, even when the y-niche dimensionis lost, clustering is still visible on the x-niche axis (Fig. 3C). Some distinct clusters collapse ontoeach other with the loss of the y-dimension, leading to detection of a lower number of clusters, butthe general clumpy structure is preserved despite the noise.The essential niche axes scenario has the opposite type of noisy kernel (Fig. 3D): competitionbetween species in the core is reliably high, while the tail is noisy because some species pairs thatare far apart on the x-axis are close on the y-axis, bringing competition up.  Again the xy-niche9space is strongly clustered as expected (Fig. 3E), and again collapsing the y-dimension does noterase the clustering pattern, which is still visible from the x-niche axis alone (Fig. 3F).In both of these examples, the process noise onto the x-niche produced by the unacknowledgedy-niche  contributions  is  not  sufficient  to  dissipate  the  pattern  on  the  x-niche  axis.   However,  asthe  contribution  of  the  y-niche  to  the  competitive  relations  increases,  so  does  the  process  noisebetween the competition coefficients and distances on the x-niche axis, and the clustering on thex-axis weakens and eventually disappears (Fig. 4).As the rank correlation between competition coefficients and niche differences degrades fromρ=−1 (fully monotonic) toρ= 0 (no correlation), the probability of clustering declines (Fig. 4A).In the case of complementary niche axes the drop is fast, but only reaches background levels nearρ=−0.5.  With essential resource axes,  clustering remains very likely untilρ≈−0.5,  at whichpoint it quickly falls off, but only drops to background levels nearρ=−0.2.The strength of the core-tail structure in the kernel predicts clustering in the face of processnoise reasonably well,  whether the niche axes are complementary or essential (Fig. 4B). In bothscenarios, that probability drops below 50% whenπ≈−0.7 (Fig. 4B).Figure 4: Probability of clustering by magnitude of noise.  The probability of clustering is estimatedas the percentage of runs of each noise scenario where clustering was statistically significant (p≤0.05), outof a total 100 replicates each.  The noise is measured as the degree of randomness between the kernel and thex-niche axis (process noise) or the trait axis (measurement noise), using two indices:A: Monotonic decline ofcompetition with species differences, measured with Spearman’s rank correlation coefficientρ.B: Core-tailstructure, defined as the difference between the proportion of tail and core elements that exceed the kernelmean.  Scenarios shown are process noise with complementary niche axes (blue curves), process noise withessential niche axes (red), and measurement noise (black).  Compare with Fig. S4.−1.0−0.8−0.6−0.4−0.20.0020406080100Spearman's ρ(A, dx)Allllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−1.0−0.8−0.6−0.4−0.20.0020406080100P(Atail>A)−P(Acore>A)BProcess noise: Complem.Process noise: EssentialMeasurement noisellllllllllllllllllllllllllllllllllllllllllllllllllllllllllll% Runs with significant clusteringIn Appendix D we present a generalized process-noise model where we assume an indeterminatenumber  of  niche  axes  and  other  contributing  factors  adding  noise  to  the  relationship  betweencompetition and the known niche axis.  We find similar results as the two-dimensional niche spacemodel, indicating that higher niche dimensions add no qualitatively new phenomena.These results indicate that even when niche space is multidimensional and part of it is unknown,we can expect clustering along a single niche axis to the extent that, on average, species with high10niche  similarity  compete  more  than  dissimilar  species.   A  fully  monotonic  relationship  betweencompetition and niche difference is not strictly required.Figure 5: Measurement noise.A-D:  Species  niche  values  plotted  against  their  proxy  trait  values.Measurement  noise  increases  from  A  to  D,  leading  to  progressively  lower  coefficient  of  determinationR2between  niche  and  trait  values.E-H:  Competition  coefficients  between  a  focal  species  near  the  centerof  the  niche  axis  (marked  by  the  red  dot  in  A-D)  and  all  other  species,  plotted  against  trait  differencebetween  them.   When  niche  and  trait  values  are  perfectly  correlated,  the  kernel  decreases  monotonicallywith  absolute  trait  differences  (E);  as  the  niche-trait  connection  loosens,  the  kernel  becomes  noisy  (F  toH). Legend numbers show the noise scores according to each of our two statistics, Spearman’sρ(A,d), andπ(A) =P(Atail>A)−P(Acore>A).I-L: Species abundance plotted against trait values.  Distinct clustersare visible when niche and traits match (I), but the pattern quickly fades asR2drops below 1 (J to L).Legend shows the estimated number of clusters and the z-score of the clustering statistic.  Stars indicatestatistical significance (∗∗:p≤0.01;∗:p≤0.05).llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll0.00.20.40.60.81.00.00.20.40.60.81.0proxtraitAR2 = 1lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.20.40.60.81.0proxtrait − prox[ind]kernelρ = −1.00π = −0.97E0.00.20.40.60.81.0051015tmp$traitnIK = 7Z = 14.7 **llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll0.00.20.40.60.81.00.00.20.40.60.81.0proxtraitBR2 = 0.99lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.20.40.60.81.0proxtrait − prox[ind]kernelρ = −0.98π = −0.86F0.00.20.40.60.81.0051015tmp$traitnJK = 7Z = 6.8 **llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll0.00.20.40.60.81.00.00.20.40.60.81.0proxtraitCR2 = 0.98lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.20.40.60.81.0proxtrait − prox[ind]kernelρ = −0.92π = −0.74G0.00.20.40.60.81.0051015tmp$traitnKK = 13Z = 0 llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll0.00.20.40.60.81.00.00.20.40.60.81.0proxtraitDR2 = 0.94lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.6−0.4−0.20.00.20.40.00.20.40.60.81.0proxtrait − prox[ind]kernelρ = −0.80π = −0.58H0.00.20.40.60.81.0051015tmp$traitnLK = 13Z = 0 Species traitAbundanceKernelSpecies nicheMeasurement noiseWhen  the  noise  is  between  niche  strategies  and  measured  trait  values  (measurement  noise),  theprobability  of  clustering  on  the  trait  axis  quickly  drops  to  zero;  faster  in  fact  than  with  noisebetween competition and niche strategies (process noise), as one can see by comparing the blackcurve to the colored curves in Fig. 4.  A glance at the correspondence between niche and trait values(Fig. 5A-D), compared with the pattern on the trait axis (Fig. 5I-L), shows that the pattern quicklyfades to oblivion even while the coefficient of determination between niche and trait values is stillvery high (R2>0.9).  This occurs not because species are not sorting into clusters, but because ourimperfect access to their true niche values misaligns them on the x-axis (Fig. 5I-L). In doing so,11measurement noise effectively brings the species assemblage closer to the null model against whichwe compare it.  Not only does statistical significance vanish, but the clustering metric also fails torecognize the true number of clusters (compare legend on Fig. 5I-L).This bodes ill for the prospects of finding niche-assembly patterns in nature, as the exact aspectsof phenotype responsible for interactions are unlikely to be known or knowable, and proxy traitswill often be our best resource to estimate them (Appendix A).We note that the plot of competition coefficients against trait differences (as opposed to nichedifferences) shows visible core-tail structure (Fig. 5E-H). Indeed,  it resembles process noise withcomplementary niche axes (cf. Fig. 3A). And yet,  the corresponding patterns are very different.A  closer  look  reveals  that  the  measurement-noise  kernel  is  more  structured  than  the  core-noisekernel (Appendix G): unlike the process noise scenario, the matrix is symmetric and the noise isautocorrelated.   In  fact,  the  measurement-noise  kernel  contains  the  same  set  of  elements  as  thenoise-free  kernel,  and  one  can  recover  the  latter  via  a  permutation  of  the  rows  and  columns  ofthe  former.   We  believe  this  non-random  structure  relative  to  the  core-noise  scenario  is  key  tounderstanding the difference in the respective patterns, but at present we lack mathematical proof.Using multiple traits to estimate niche valuesWhen multiple traits are related to the niche axis and are otherwise uncorrelated with each other,their  first  principal  component  is  a  better  proxy  for  the  niche  axis  than  most  of  the  individualtraits.  Other things being equal, clustering on the first component is stronger as more traits areused (Fig. 6A), reflecting the fact that the quality of the first component as a proxy for the nicheaxis  increases  with  the  number  of  traits  measured.   However,  the  number  of  traits  required  forstatistically significant clustering on the first component can be very high.  Even when the averageR2between  niche  and  trait  values  is  as  high  as  0.9,  we  needed  at  least  5  traits  for  significantclustering at thep≤0.1 level and 7 traits at thep≤0.05 level.  For lowerR2, denoting looser tiesbetween trait and niche levels, that minimum number quickly rises (Fig. 6B).We note that although the first component is typically a better proxy than an individual traitaxis, it will not necessarily be better than every single trait (see Fig. S5 in Appendix E). If oneknows that a given trait is a much better proxy for species niche values than all other traits,  itmay be better to use that trait alone rather than to run principal component analysis on a set oftraits.  Realistically,  however,  such cases would be exceptional,  as ecologists have only imperfectknowledge of the connection between measurable traits and niche strategies.  Compared to traitswith a moderate to high association with the niche axis, the first principal component has a higherchance of revealing niche pattern (Fig. S5);  and the more traits,  the higher that advantage.  Ofcourse, no number of traits is a substitute for high-quality traits, i.e.  traits demonstrated to reflectspecies niche strategies.  This is especially true given the high sensitivity of pattern to measurementnoise, as seen above.In general, the number of traits required for detecting pattern will depend on their relation withthe niche, which may be more complicated than presented here.  Our linear model illustrates howeven in a simple case, many traits may be necessary to parse the pattern.12Figure 6: Using multiple traits to mitigate measurement noise.A: Degree of clustering on a firstprincipal component axis increases with the number of independent traits used in the principal componentanalysis (PCA). Curves represent scenarios with different degree of measurement noise, with an averageR2between trait and niche values across species ranging from 0.5 (lightest shade of gray) to 0.9 (darkest), atintervals of approximately 0.05.  Values shown are averaged across 100 runs of each scenario.  Red line showsthe clustering z-score on the niche axis.B: Lowest number of traits required to detect significant clusteringon the first component axis, as a function of the averageR2between trait and niche values.  Black and redcurves show results using significance thresholdα= 0.05 and 0.1, respectively.  Values shown are averagedacross 100 runs of each scenario.02040608010002468101214Number of traits in the PCAClustering z−scoreAllllllll0.50.60.70.80.9020406080100Average R2Minimum number of traits for significancellllllllllα = 0.05α = 0.10BDiscussionUnderstanding how competition drives biodiversity patterns remains a challenge in ecology.  Thehypothesis  of  self-organized  similarity  or  emergent  neutrality  (Scheffer  and  van  Nes,  2006;  Holt,2006) states that competing species may sort into groups of species with similar traits.  This conceptmay generalize classical limiting similarity theory (D’Andrea and Ostling, 2016) and reconcile itwith contrasting empirical findings (Chase and Leibold, 2003; G ̈otzenberger et al., 2012).  However,the relevance of these ideas for field ecologists is limited by assumptions idealizing the connectionbetween competition and niche strategies, and between niche strategies and measurable traits.  Herewe tested how uncertainty in these connections impacts the prospects of detecting the pattern innature.When we introduced noise in the link between competition and niches, we found considerablerobustness.  Clustering remains likely as long as the kernel has a distinctive core-tail structure.  Inother  words,  competition  between  species  far  apart  on  the  niche  axis  must  be  on  average  lowerthan between those close together.  That the required trend is statistical rather than strict makesclustering on a single niche axis a distinct possibility in nature, even when competition is the productof multiple niche axes.  Of course, probing multiple niche axes will make any pattern even cleareras  it  should  minimize  process  noise.   However,  this  is  not  automatically  achieved  by  measuringmultiple traits.  Trait space is constrained by traits’ roles in ecological performance (Shoval et al.,2012), and in fact a large set of traits may collapse into a single niche axis (Wright et al., 2004).13To  properly  assess  multidimensional  niche  space,  one  must  use  traits  related  to  different  nichedimensions.  Knowledge of these dimensions and their relationship to traits requires natural historyexpertise.  Absent that, process noise is inevitable.In contrast, we found high sensitivity to measurement noise.  This is because measurement noiserandomizes species positions along the true niche axis.  In doing so,  it brings the data closer tothe null model.  One cannot connect the distribution of species along an axis to mechanism if thatdistribution is random.  Therefore, to stand a chance at finding pattern one must keep measurementnoise at a minimum.  This requires a tight link between niche axes and the actual traits measured infield studies, such that the proxy traits provide high-accuracy estimates of species niche strategies.A large set of traits with a demonstrated role in niche strategies is better than a few traits withweak functional connections.  Demonstrating such roles requires explicit theory (Pacala and Rees,1998; Kohyama, 2006), and extensive empirical work (Violle et al., 2007; Litchman and Klausmeier,2008; Sterck et al., 2011; Herben and Goldberg, 2014).The  kernel  contains  all  information  about  species  interactions,  and  hence  holds  the  key  topattern.   Mathematical  proofs  connect  kernel  and  trait  patterns  in  simpler  models  lacking  noise(Hern ́andez-Garc ́ıa et al., 2009; Fort et al., 2009; Leimar et al., 2013).  However, more general ker-nels are less amenable to analytical proofs, and as yet have only been studied via simulations.  Ourresults indicate that core-tail kernel structure is critical for trait pattern, but a more complete the-ory predicting the pattern from the shape of the kernel is still missing.  Providing a low-dimensionalrepresentation of the kernel that predicts pattern in realistic noisy systems remains an open chal-lenge.Our  study  is  a  step  towards  more  realistic  models  of  trait-based  patterns  of  niche  assembly.Our results complement previous explorations of trait-based niche patterns that considered otherforms  of  noise  such  as  demographic  or  environmental  stochasticity  (Tilman,  2004;  Gravel  et  al.,2006; Ernebjerg and Kishony, 2011; D’Andrea et al., 2018).  Attempts at higher realism would alsorequire  dedicated  multidimensional  niche  models.   Multidimensional  niche  space,  despite  havinglong been recognized as part and parcel of niche theory (May, 1975; Tilman, 1982; Holt, 1987),remains understudied in theoretical ecology (but see Fort et al. 2010; Geange et al. 2011; Ekl ̈of et al.2013), and essentially untouched in the trait pattern literature.  Finally, our models neglect non-competitive interactions, and require restorative forces such as immigration to replenish otherwisetransient  clusters.   However,  our  results  provide  insight  into  the  prospects  of  finding  clusters  insystems where both competition and dispersal are known to play a large role in community assembly,such as grasslands (Tilman, 1994) and tropical forests (Vellend, 2016).To  our  knowledge,  we  are  the  first  to  examine  how  uncertainty  about  the  drivers  of  speciesinteractions impacts ecologists’ ability to detect their effect on community structure.  Our findingshighlight that theoretical results are only useful to field work when they are robust to uncertainty.More broadly, our work can initiate a more general picture of this robustness or lack thereof acrossdifferent patterns and processes.AcknowledgmentsJ.OD.  acknowledges  the  Simons  Foundation  Grant  #376199  and  McDonnell  Foundation  Grant#220020439.  A.O. acknowledges the National Science Foundation Grant #1038678, Niche versusneutral structure in populations and communities funded by the Advancing Theory in Biology pro-gram, the Danish National Research Foundation Grant #DNRF96 through support of the Centerof Macroecology, Evolution and Climate, and the Miller Institute for Basic Research in Science atthe University of California, Berkeley.14ReferencesAbrams, P. (1983). The Theory of Limiting Similarity.Annual Review of Ecology and Systematics,14(1):359–376.Barab ́as, G., D’Andrea, R., Rael, R., Mesz ́ena, G., and Ostling, A. M. (2013). Emergent Neutralityor Hidden Niches?Oikos, 122:1565–1572.Bonsall,  M.  B.,  Jansen,  V.  A.  A.,  and  Hassell,  M.  P.  (2004).   Life  history  trade-offs  assembleecological guilds.Science (New York, N.Y.), 306(5693):111–4.Chase,  J.  M.  and  Leibold,  M.  (2003).Ecological  Niches:   Linking  Classical  and  ContemporaryApproaches.  The University of Chicago Press.D’Andrea, R. and Ostling, A. (2017).  Biodiversity maintenance may be lower under partial nichedifferentiation than under neutrality.Ecology, 98(12):3211–3218.D’Andrea, R. and Ostling, A. M. (2016). Challenges in linking trait patterns to niche differentiation.Oikos, 125(10):1369–1385.D’Andrea, R., Riolo, M., and Ostling, A. M. (2018). Competition and immigration lead to clustersof similar species, not trait separation.bioRxiv, (doi:  https://doi.org/10.1101/264606).Ekl ̈of, A., Jacob, U., Kopp, J., Bosch, J., Castro-Urgal, R., Chacoff, N. P., Dalsgaard, B., de Sassi,C., Galetti, M., Guimar ̃aes, P. R., Lom ́ascolo, S. B., Mart ́ın Gonz ́alez, A. M., Pizo, M. A., Rader,R., Rodrigo, A., Tylianakis, J. M., V ́azquez, D. P., and Allesina, S. (2013).  The dimensionalityof ecological networks.Ecology Letters, 16(5):577–583.Ernebjerg, M. and Kishony, R. (2011).  Dynamic phenotypic clustering in noisy ecosystems.PLoScomputational biology, 7(3):e1002017.Fort,  H.,  Scheffer,  M.,  and  van  Nes,  E.  H.  (2009).   The  paradox  of  the  clumps  mathematicallyexplained.Theoretical Ecology, 2(3):171–176.Fort,  H.,  Scheffer,  M.,  and  van  Nes,  E.  H.  (2010).   The  clumping  transition  in  niche  competi-tion:  a robust critical phenomenon.Journal  of  Statistical  Mechanics:  Theory  and  Experiment,2010(05):P05005.Geange,  S.  W.,  Pledger,  S.,  Burns,  K.  C.,  and  Shima,  J.  S.  (2011).   A  unified  analysis  of  nicheoverlap incorporating data of different types.Methods in Ecology and Evolution, 2(2):175–184.G ̈otzenberger,  L.,  de  Bello,  F.,  Br ̊athen,  K.  A.,  Davison,  J.,  Dubuis,  A.,  Guisan,  A.,  Lepˇs,  J.,Lindborg, R., Moora, M., P ̈artel, M., Pellissier, L., Pottier, J., Vittoz, P., Zobel, K., and Zobel,M. (2012).  Ecological assembly rules in plant communities-approaches, patterns and prospects.Biological Reviews, 87(1):111–127.Gravel, D., Canham, C. D., Beaudet, M., and Messier, C. (2006). Reconciling niche and neutrality:the continuum hypothesis.Ecology letters, 9(4):399–409.Herben, T. and Goldberg, D. E. (2014). Community assembly by limiting similarity vs. competitivehierarchies:   Testing  the  consequences  of  dispersion  of  individual  traits.Journal  of  Ecology,102(1):156–166.15Hern ́andez-Garc ́ıa,  E.,  L ́opez,  C.,  Pigolotti,  S.,  and  Andersen,  K.  H.  (2009).   Species  competi-tion:  coexistence, exclusion and clustering.Philosophical  Transactions  of  the  Royal  Society  A,367(1901):3183–95.Holt, R. (1987).  On the Relation between Niche Overlap and Competition :  The Effect of Incom-mensurable Niche Dimensions.Oikos, 48(1):110–114.Holt, R. D. (2006).  Emergent neutrality.Trends in Ecology & Evolution, 21(10):531–3.Hubbell,  S. P. (2001).The  Unified  Neutral  Theory  of  Biodiversity  and  Biogeography.  PrincetonUniversity Press, Princeton, NJ.Kohyama, T. (2006).  The effect of patch demography on the community structure of forest trees.Ecological Research, 21(3):346–355.Leimar, O., Sasaki, A., Doebeli, M., and Dieckmann, U. (2013). Limiting similarity, species packing,and the shape of competition kernels.Journal of Theoretical Biology, 339:3–13.Litchman, E. and Klausmeier, C. A. (2008).  Trait-Based Community Ecology of Phytoplankton.Annual Review of Ecology, Evolution, and Systematics, 39(1):615–639.MacArthur, R. H. and Levins, R. (1967). The Limiting Similarity, Convergence, and Divergence ofCoexisting Species.The American Naturalist, 101(921):377–385.MacQueen, J. B. (1967). Some Methods for classification and Analysis of Multivariate Observations.5th Berkeley Symposium on Mathematical Statistics and Probability 1967, 1(233):281–297.May, R. M. (1975).  Some Notes on Estimating the Competition Matrix.Ecology, 56(3):737–741.McDonald, J. H. (2009).Handbook  of  Biological  Statistics.  Sparky House Publishing, Baltimore,Maryland, USA, second edition.McGill, B. J., Enquist, B. J., Weiher, E., and Westoby, M. (2006).  Rebuilding community ecologyfrom functional traits.Trends in ecology & evolution, 21(4):178–85.Pacala,  S. W. and Rees,  M. (1998).  Models suggesting field experiments to test two hypothesesexplaining successional diversity.The American Naturalist, 152(5):729–37.Pigolotti, S., Lopez, C., Hern ́andez-Garc ́ıa, E., and H., K. A. (2010).  How Gaussian competitionleads to lumpy or uniform species distributions.Theoretical Ecology, 3(2):89–96.R Core Team (2017).  R: A Language and Environment for Statistical Computing.Sakavara,  A.,  Tsirtsis,  G.,  Roelke,  D.  L.,  Mancy,  R.,  and  Spatharis,  S.  (2018).   Lumpy  speciescoexistence  arises  robustly  in  fluctuating  resource  environments.Proceedings  of  the  NationalAcademy of Sciences.Scheffer, M. and van Nes, E. H. (2006).  Self-organized similarity, the evolutionary emergence ofgroups of similar species.Proceedings of the National Academy of Sciences of the United Statesof America, 103(16):6230–6235.Scheffer, M., Vergnon, R., Van Nes, E. H., Cuppen, J. G., Peeters, E. T., Leijs, R., and Nilsson,A.  N.  (2015).   The  evolution  of  functionally  redundant  species;  Evidence  from  beetles.PLoSONE, 10(10):1–10.16Schoener,  T.  W.  (1974).   Resource  partitioning  in  ecological  communities.Science  (New  York,N.Y.), 185(4145):27–39.Schoener, T. W. (1976).  Alternatives to Lotka-Volterra competition:  models of intermediate com-plexity.Theoretical population biology, 10(3):309–33.Scranton, K. and Vasseur, D. A. (2016).  Coexistence and emergent neutrality generate synchronyamong competitors in fluctuating environments.Theoretical Ecology, 9(3):353–363.Segura,  A.  M.,  Calliari,  D.,  Kruk,  C.,  Conde,  D.,  Bonilla,  S.,  and  Fort,  H.  (2011).   Emergentneutrality drives phytoplankton species coexistence.Proceedings. Biological sciences / The RoyalSociety, 278(1716):2355–61.Segura, A. M., Kruk, C., Calliari, D., Garc ́ıa-Rodriguez, F., Conde, D., Widdicombe, C. E., andFort, H. (2013).  Competition Drives Clumpy Species Coexistence in Estuarine Phytoplankton.Scientific Reports, 3(1):1037.Shoval,  O.,  Sheftel,  H.,  Shinar,  G.,  Hart,  Y.,  Ramote,  O.,  Mayo,  A.,  Dekel,  E.,  Kavanagh,  K.,and Alon, U. (2012).  Evolutionary trade-offs, pareto optimality, and the geometry of phenotypespace.Science, 336(June):1157–1161.Sterck,  F.,  Markesteijn,  L.,  Schieving,  F.,  and  Poorter,  L.  (2011).   Functional  traits  determinetrade-offs  and  niches  in  a  tropical  forest  community.Proceedings  of  the  National  Academy  ofSciences of the United States of America, 108(51):20627–32.Tibshirani, R., Walther, G., and Hastie, T. (2001). Estimating the number of clusters in a data setvia the gap statistic.Journal of the Royal Statistical Society:  Series B (Statistical Methodology),63:411–423.Tilman,  D. (1982).Resource  competition  and  community  structure.  Princeton University Press,monographs edition.Tilman,  D.  (1994).    Competition  and  Biodiversity  in  Spatially  Structured  Habitats.Ecology,75(1):2–16.Tilman,  D. (2004).  Niche tradeoffs,  neutrality,  and community structure:  a stochastic theory ofresource competition, invasion, and community assembly.Proceedings of the National Academyof Sciences of the United States of America, 101(30):10854–61.Vellend, M. (2016).The theory of ecological communities.  Princeton University Press.Vergnon, R., Dulvy, N. K., and Freckleton, R. P. (2009).  Niches versus neutrality:  uncovering thedrivers of diversity in a species-rich community.Ecology letters, 12(10):1079–90.Vergnon, R., van Nes, E. H., and Scheffer, M. (2013). Interpretation and predictions of the emergentneutrality model:  A reply to Barab ́as et al.Oikos, 122(11):1573–1575.Violle, C., Navas, M.-L., Vile, D., Kazakou, E., Fortunel, C., Hummel, I., and Garnier, E. (2007).Let the concept of trait be functional!Oikos, 116(5):882–892.Wright, I. J., Reich, P. B., Westoby, M., Ackerly, D. D., Baruch, Z., Bongers, F., Cavender-Bares,J., Chapin, T., Cornelissen, J. H. C., Diemer, M., Flexas, J., Garnier, E., Groom, P. K., Gulias,J.,  Hikosaka,  K.,  Lamont,  B.  B.,  Lee,  T.,  Lee,  W.,  Lusk,  C.,  Midgley,  J.  J.,  Navas,  M.-L.,17Niinemets, U., Oleksyn, J., Osada, N., Poorter, H., Poot, P., Prior, L., Pyankov, V. I., Roumet,C., Thomas, S. C., Tjoelker, M. G., Veneklaas, E. J., and Villar, R. (2004).  The worldwide leafeconomics spectrum.Nature, 428(6985):821–7.Wright,  S. J.,  Kitajima,  K.,  Kraft,  N. J. B.,  Reich,  P. B.,  Wright,  I. J.,  Bunker,  D. E.,  Condit,R., Dalling, J. W., Davies, S. J., D ́ıaz, S., Engelbrecht, B. M. J., Harms, K. E., Hunter, M. O.,Marks, C. O., Ruiz-Jaen, M. C., Salvador, C. M., and Zanne, A. E. (2010). Functional traits andthe growth-mortality trade-off in tropical trees.Ecology, 91(12):3664–74.Yan, B., Zhang, J., Liu, Y., Li, Z., Huang, X., Yang, W., and Prinzing, A. (2012).  Trait assemblyof  woody  plants  in  communities  across  sub-alpine  gradients:   Identifying  the  role  of  limitingsimilarity.Journal of Vegetation Science, 23(4):698–708.18Appendices for Translucent windows:  how uncertainty incompetitive interactions impacts detection of community patternRafael D’Andrea1,∗, Annette Ostling2,∗∗& James O’Dwyer1,†1Dept. Plant Biology, University of Illinois at Urbana-Champaign, IL, USA2Dept. Ecology & Evolutionary Biology, University of Michigan, Ann Arbor, MI, USA∗rdandrea@illinois.edu,∗∗aostling@umich.edu,†jodwyer@illinois.eduA  Niche spaceClusters emerge in models where species belong in a niche space, typically a one-dimensional line,and their competitive impact on one another is a function of their mutual distances in that space.The definition of niche space here is abstract and operational:  it is the set of aspects of organismperformance that affect competition; species sufficiently far apart in that space can stably coexist.For example, in a model of birds competing for two substitutable food types, say pollen andinsects,  a  species’  niche  is  the  amount  of  time  it  spends  foraging  for  each  food.   Assuming  thetotal  foraging  time  is  fixed,  the  niche  space  is  a  one-dimensional  axis,  with  points  on  that  axisindicating how long the species spend on one of the resources—the time spent on the other food isthen set, as both times need to add to a fixed amount.  If there are three substitutable resources,say pollen, insects, and seeds, then niche space is a two-dimensional plane, and so on.  The classicalMacArthur-Levins (1967) model assumes a continuous resource axis with an indefinite number offood types—say, seeds falling on a size continuum—which in principle makes niche space infinite-dimensional.   However,  the  number  of  dimensions  drops  if  there  are  further  constraints  on  theamount  of  time  a  bird  can  spend  on  each  food.   MacArthur  and  Levins  (1967)  considered  theextreme scenario where the relative time spent on one of the resources fixes the time spent on allothers:  they  assumed  every  species  share  a  resource  utilization  curve  that  differs  only  by  whatresource it peaks on,  i.e.  the seed they eat the most.  In that case,  niche space collapses onto asingle axis.Under this operational definition, a species’ niche is not necessarily a resource, measurable trait,or the environment where it lives.  Those are only associated with the niche to the extent that theyaffect competition.  In the example of birds competing for seeds falling on a size continuum, theassumption of same-shape resource utilization curves across all species means a species’ favoriteresource suffices to determine its niche.  In this case the niche itself can be equated with the favoriteseed size.  More generally the niche would be a list of numbers reflecting the amount of time spenton seeds of each size.  A relevant trait such as beak size will correlate with its favorite food (Schluterand Grant, 1984), but even in this idealized example of a one-dimensional niche axis the correlationbetween niche and trait need not be one-to-one, as birds’ beaks are also shaped by other functionssuch as singing (Huber and Podos, 2006).1arXiv:1802.10224v1  [q-bio.PE]  28 Feb 2018B  Competition for essential resources leads to tail noise, and min-imum distances in niche space are a good predictor of compet-itive interactionsConsider  a  resource-consumer  model  with  two  resource  axes.   Resources  grow  logistically  in  theabsence of consumers.  Consumers niche strategies determine their resource preference along eachresource axis, but they need resources from both axes to grow.  One example is animals that thriveon a diet containing both plant and animal foods.  We implement this by having consumer growthrates depend multiplicatively on resources from both axes (Saito et al., 2008):dAdt=μ−mA+(R∑i=1exγAXiXiR∑i=1eyγAYiYi)A(1)where A is the abundance of the consumer, m is its intrinsic mortality,μis the immigration rate,R is the number of resources on each axis,Xiare the abundances of the x-resources,γAXiquantifiesthe consumer preference for the i-th x-resource, andexis the conversion efficiency—similarly forthe y resources.  The product in the consumption derives from the law of mass action in chemistry,in this case representing a reaction that needs three components to occur (the consumer and thetwo resource types).  In our biological context,  the term reflects a situation where each resourcetype offers nutrients not found in the other type,  and the consumption of both types are linkedtogether because the consumer will lack the energy to forage if it lacks either.The corresponding resource equations aredXidt=ν+Xir(1−XiK)−S∑N=1γNXiNS∑j=1γNYjYjXi(2)dYidt=ν+Yir(1−YiK)−S∑N=1γNYiNS∑j=1γNXjXjYi(3)whereris the resource intrinsic growth rate,Kthe carrying capacity,νthe resource immigrationrate,  andSthe  number  of  consumers.   Notice  that  these  equations  reflect  the  abovementionedlinked consumption of both resource types.We note that this type of resource-consumer interaction is not the only way to model colim-itation by more than resource; another common approach is Liebigs law of the minimum1(Saitoet al., 2008).  Empirically, consumers show a variety of responses to addition of essential resources,compatible with different models (Harpole et al., 2011).  Our model predicts that consumers willrespond to addition of either resource in isolation, and will respond maximally to addition of bothresources.   This  has  been  observed  in  communities  of  bacteria  (Danger  et  al.,  2008),  plankton(Harpole et al., 2011), and plants (Craine and Jackson, 2010).For  simplicity,  we  setμ,ν,r,K,ex,eyidentical  across  species  and  resources,  so  that  we  canfocus  on  the  competitive  effect  of  differences  in  resources  preferences.   We  set  the  preference  of1Our multiplicative model corresponds to chemicals in a vat where the reaction is C + A + B→C + C, i.e.  bothsubstances A and B must be present at the same time for C to generate a new C; in contrast, the Liebig scenariocorresponds to a reaction like C + A→CA; CA + B→C + C, i.e.  where there is a stable intermediate state suchthat C does not need to encounter A and B at the same time, but still needs both to generate a new C. In biologicalterms, Liebig’s law corresponds to a case where the consumer acquires each resource independently of the other butwill not grow without both, whereas in the multiplicative model the consumer’s ability to acquire one of the resourcesdepends on having access to the other.2consumerAfor resourcexito be a declining function of the difference between the resource andthe consumer’s favorite resourcexAalong that axis,γAXi= exp(−((xA−xi)/wx)4).  Similarly fory-resources.Competition kernelConsumer-resource interactions do not map trivially to Lotka-Volterra competition coefficients thatdepend only on trait distances.  In general, this mapping might only be valid in the vicinity of anequilibrium (Schoener, 1974, 1976).  In fact, expansions of small perturbations around equilibria isthe traditional approach to converting resource-consumer models to Lotka-Volterra form, and thusextracting competition coefficients valid in that regime (MacArthur, 1972; Abrams, 1980).  This isthe approach we adopt here.The competition kernel, which quantifies the competitive impact of consumers on one another,is  comprised  of  the  matrix  elementsαAB=−∂∂B(1AdAdt)∣∣∣∣A∗B∗X∗Y∗,  where  the  asterisk  denotesequilibrium abundances.  We calculate it explicitly via linearization around the equilibrium:A(t) =A∗+a(t);Xi(t) =X∗i+xi(t);Yj(t) =Y∗j+yj(t)Substituting in the consumer equation and discarding higher order terms:dAdt=μ−(A∗+a)m+ (A∗+a)exey∑i∑jγAXiγAYj(X∗i+xi)(Y∗j+yj)≈−aμA∗+A∗exey∑ijγAXiγAYj(Y∗jxi+X∗iyj)The competition coefficients are thenαAB=−∂∂B(1AdAdt)=δABμA∗2−exey∑ijγAXiγAYj(Y∗j∂xi∂B+X∗i∂yi∂B)=δABμA∗2+exey((AY∗)·(−∂xi∂B)+ (ATX∗)·(−∂yi∂B))(4)where in the last line we used compact matrix notation, withAij≡γAXiγAYj, and the dot indicatinginternal product between the vectors.To proceed we must writexandyin terms of the consumer abundances.  We do so by assumingresources undergo faster dynamics than consumers:0 =dXidt=ν+r(X∗i+xi)(1−X∗i+xiK)−(X∗i+xi)∑N∑jγNXiγNYj(N∗+n)(Y∗j+yj)=−νX∗ixi−rX∗ixiK−X∗i∑N∑jγNXiγNYj(N∗yj+Y∗jn)→xi=−1νX∗2i+rK∑N∑jγNXiγNYj(N∗yj+Y∗jn)We can write this expression in compact matrix notation:x=Pxy+QxY∗3wherePxij=−xi∑NN∗γNXiγNYj,Qxij=−xi∑NnγNXiγNYj, andxi= 1/(ν/X∗2i+r/K).  Noticethat matrixPxis a constant whereas matrixQxdepends on the consumer perturbations.We get an analogous expression for the y resources:y=Pyx+QyX∗with parameters mirroring those of the x resources.Solving this linear system forxandy, we getx= (1−PxPy)−1(PxQyX∗+QxY∗)y= (1−PyPx)−1(PyQxY∗+QyX∗)Substituting these in Eq. (4) and definingBxij≡xiγBXiγBYjandByij≡yiγBYiγBXj, we obtain ourcompetition kernel:αAB=δABμA∗2+exey(AY∗)·((1−PxPy)−1(PxByX∗+BxY∗))+exey(ATX∗)·((1−PyPx)−1(PyBxY∗+ByX∗))(5)ResultsFirst,  we note that if we unplug the y resources from consumer dynamics,  such that only the xresources regulate those species, then differences in x-niche strategies are almost perfect predictorsof pairwise competitive relations.  In other words, if niche space is one-dimensional, niche strategiesfully determine competitive interactions, and we therefore have no process noise.Next,  we  add  the  y  resources  back  in.   Fig.  S1A  shows  a  community  obtained  by  numericalsimulation of this model, with species arranged by their x-niche.  Despite niche space being two-dimensional, with both x and y resources modulating species dynamics, the clustered abundancepattern is visible along the x-niche axis, as confirmed by our clustering metric (results summarizedin the legend of the plot). Thus, even if the y-niche strategies of these species were entirely unknown,we would still be able to infer niche dynamics from the x-axis alone.  The competition kernel, ascalculated via Eq. (5), correlates with x-niche distances (Fig. S1C), but the relationship is noisybecause of the contribution of the y-niche.  The hidden y-niche adds process noise.To determine whether the noise was higher in the core or tail of the kernel, we fitted a cubicspline to each row of the kernel—which for each species in the community describes the competitiveimpact of all other species—and compared the expected kernel values from the spline against theobserved values.  Species pairs were deemed to be in the core or tail based on whether they werebelow  or  above  the  niche  distance  at  which  the  splined  kernel  is  at  the  community-level  mean.Using the chi-squared statisticχ2i=∑j(αij−ˆαij)2/ˆαij, we found that the noise is higher in thetail (χ2core= 0.04,χ2tail= 0.07).The  minimum  of  the  niche  distances  on  either  axis  is  a  better  predictor  of  the  competitioncoefficients  (Fig.  S1D).  In  particular,  the  minimum  distance  is  a  much  better  predictor  of  thekernels tail than the x-distance:  unlike the x-distance, a large minimum distance is a reliable signof low competitive interactions.These results support our assumptions in the main text that essential resource axes may leadto noise in the tail of the kernel, and that the pairwise competitive relations are strongly associatedwith the minimum distance in the full niche space.4To summarize our findings regarding competition for essential resources:  when niche space isone-dimensional,  niche strategies fully determine competitive interactionsi.e.  there is no processnoise.  When niche space is multidimensional, the map from competition to niche strategies is noisy,but the minimum distance in niche space is a good approximation.  If we have no information onone of the niche dimensions, this process noise is compounded, particularly in the tail.5Figure S1: Generalized process noise.A. Species abundances by their x-niche.  Legend shows numberof clusters (K), z-score of the gap statistic (Z), and corresponding p-value (P);B. Resource abundances alongeach resource axis;C. Pairwise competition coefficients calculated from consumer and resource abundancesusing Eq. (5), plotted against species differences in x-niche strategies.  There is a visible negative correlation.Legend  shows  rank  correlation  (Spearmansρ);D.  Competition  coefficients  plotted  against  the  minimumbetween dx and dy (scaled by the width of the respective resource use functionsγ).  Parameters used in thesimulation:S=R= 100;ex=ey= 1;K= 0.1;r= 100;m= 1;μ= 10−5;ν= 0.1;wx= 0.11;wy= 0.08.All species and resources start with identical abundances, and we run the simulation until abundances areno longer changing.0.00.20.40.60.81.00510152025ConsumersX − nicheAbundanceAK = 9Z = 3.5P < 0.010204060801000.60.70.80.9ResourcesResource indexAbundance / Carrying capacityBX resourcesY resources02468−0.010.000.010.020.03|dx / wx|Competitionρ = −0.53C02468−0.010.000.010.020.03min(|dx / wx|, |dy / wy|)Competitionρ = −0.87D6C  Competition for available space in two niche dimensions leadsto core noise, and Euclidean distances are a good predictor ofcompetitive interactionsConsider a community of plants in a heterogeneous landscape.  Plants compete for space, and thelandscape is composed of patches, each of which can contain one individual.  The local environmentin each patch is characterized by two independent indices (for instance, soil humidity and salinity),and  different  species  are  optimally  adapted  to  different  suites  of  environmental  conditions  (i.e.different combinations of humidity and salinity).  In this situation, the resource is available spacewith specific environmental conditions.  Niche space is two-dimensional, in the sense that speciesniche strategies pertain to their affinities for these two independent environmental properties.We can model such a scenario as follows:dNikldt=−mNikl+bTiklXklNi(6)Xkl=c−∑iNikl(7)whereNiklis the abundance of speciesiin patches with humiditykand salinityl, andXklis thenumber of currently unoccupied patches with those conditions.  The first term in Eq. 6 representsdeath, which for simplicity we assume occurs at the same ratemfor all individuals in all patches.The second represents births, which are mediated by the species affinity for the local environmentalconditions,Tikl.  We assume no dispersal limitation:  all individuals of speciesicontribute offspringequally to all patches (hence the factorNiin the birth term, as opposed to a weighted combinationofNikl).  The birth ratebis the same for all species and patches, but varies over time dependingon abundances and site occupancy, such that the total number of births balances the total numberof deaths.  This portrays a community with a seed bank that enables newly available sites to bequickly colonized,  but  where births are  limited by available space,  which  is in turn provided bydeaths.  The number of available patches of humiditykand salinitylis equal to the total numberof patchescin the community with those conditions, minus the total occupancy in these sites.  Forsimplicity, we assumecis the same for all environmental conditions.We can sum Eq. 6 over the patches to find the dynamic equation for species abundances:∑kldNikldt=dNidt=−mNi+bτiNi(8)whereτi=∑klTiklXkl. Note that in order to match total births and deaths,b=m(∑iNi)/(∑iτiNi).This dependence of the birth rate on deaths reflects offspring’s need for available gaps to recruit,and provides a stabilizing mechanism that prevents populations from growing indefinitely.Substituting Eq. 8 in the usual definition of the competition coefficients,αij=−∂∂Nj(1NidNidt)∣∣∣∣N∗,we getαij=−(∂τi∂Njb+τi∂b∂Nj)(9)Before we can calculate those derivatives, we must note thatτiandbare defined in terms of patch-specific subpopulations.  Therefore we must convert∂/∂Njinto∂/∂Njkl.  This conversion dependson how an increment to the populationNjis distributed across the different patches.  The naturalassumption is that it will occur in proportion to the species affinity for the local environment in these7patches,  reflecting  local  filters.   In  other  words,dNjkl=1∑k′l′Tjk′l′TjkldNj.   The  proportionalityconstant ensures that∑kldNjkl=dNj.  It then follows that∂∂Nj=1∑k′l′Tjk′l′∑klTjkl∂∂Njkl.Applying the derivatives in Eq. 9 and using Eq. 7, we obtainαij=b∑klTiklTjkl∑k′l′Tjk′l′−m∑i′Ni′τi′+m∑i′Ni′(∑i′Ni′τi′)2(τj−∑i′Ni′∑klTiklTjkl∑k′l′Tjk′l′)(10)This expression is not particularly illuminating, but we note that it contains terms like∑klTiklTjkl,which represent the overlap in environmental preferences between speciesiandj. This is in the samespirit as the classical work by MacArthur and others (MacArthur and Levins, 1967; MacArthur,1972).To complete the model, we must specify the environmental preferences of our different species.Suppose speciesihas a preferred humidity levelxiand salinity levelyi.  Those preferences definethe species niche strategy.  Its affinity for a patch with humidityxkand salinityylwill then beTikl= exp−(∣∣∣∣xi−xkwx∣∣∣∣2+∣∣∣∣yi−ylwy∣∣∣∣2)2In words, the affinity is a declining function of the (two-dimensional) difference between the localenvironment  and  the  species’  preferred  environment.   The  weighting  factorswxandwyset  therelative scales of the x- and y-environmental dimensions.  For instance in the limit wherewywx,species are indifferent to the y-dimension relative to the x-dimension.  This will occur for exampleif they have similar tolerance to all salinity levels within the landscape’s range.  In that case, nichespace is one-dimensional.Results  from  numerical  implementation  of  this  model  are  shown  in  Fig.  S2.   Species  clusteralong their x-environmental preferences (the x-niche, Fig. S2A), even though competition does notcorrelate  perfectly  with  differences  in  x-preference  (Fig.  S2B).  The  noise,  visible  as  a  scatter  inthe  cloud  of  points,  occurs  mostly  between  species  with  similar  x-preferences.   In  other  words,the  noise  is  greater  in  the  core  than  in  the  tail.   (Contrast  this  with  the  tail-heavy  noise  fromthe resource-consumer model of competition for essential resources, Appendix B.) The correlationwith differences in y-preference is also imperfect (Fig. S2C). It is only when we plot competitioncoefficients against the Euclidean distance that we see a tight relationship (Fig. S2D).In summary, when we ignore either niche dimension, we face noise in the correspondence betweencompetitive interactions and the observed niche strategies.  That noise is concentrated in the core ofthe competition kernel.  This is because if all we know is that two species are similar with respect totheir x-preference, we may overestimate how strongly they compete because they may compensatefor their x-similarity with very dissimilar y-niche requirements.  On the other hand, the Euclideandistance in the two-dimensional niche space is an excellent predictor of competition.  These resultssupport our simple Lotka-Volterra model for complementary resources presented in the main text.8Figure S2: Competition for available space in two niche dimensions leads to core noise.A.Species abundances by their x-niche.  Legend shows number of clusters (K), z-score of the gap statistic (Z),and corresponding p-value (P);B. Pairwise competition coefficients calculated from consumer abundancesusing Eq. (10), plotted against species differences in x-niche strategies.  There is a visible negative correlation,but  it  is  noisy,  especially  in  the  core;C.  Competition  coefficients  plotted  against  differences  in  y-nichestrategies  show  a  similar  pattern.D.  Plotting  competition  against  the  Euclidean  distance  (with  dx  anddy scaled by the respective weighting factors) resolves the core noise.  Parameters used in the simulation:S= 100 species;R= 10 different environmental levels in each dimension;m= 0.01;wx= 0.1;wy= 0.38.Both x- and y-niche strategies range from 0 to 1, as do environmental levels.  All species start with identicalabundances, totaling the carrying capacity of the community, such that community size does not vary.  Wethen run the simulation until abundances are no longer changing.0.00.20.40.60.81.00100200300400500X − nicheAbundanceAK = 7Z = 1.6P = 0.070.00.20.40.60.81.0−0.20.00.20.40.60.81.0dxCompetition coefficientB0.00.20.40.60.81.0−0.20.00.20.40.60.81.0dyCompetition coefficientC0.00.20.40.60.81.0−0.20.00.20.40.60.81.0Competition coefficientD(dxwx)2+(dywy)29D  Generalized process noiseIn  the  main  text  we  showed  how  process  noise  arises  from  incomplete  access  to  full  niche  spacein an example where niche space is two-dimensional.  Here we generalize this model, assuming anindeterminate number of unseen niche axes and other contributing factors which collectively addnoise to the relationship between competition and x-niche differences.  We thus setAij= exp(−(|xi−xj|/w)4) +εij,where  the  noise  termεijis  a  normally  distributed  random  variable  with  mean  0.   We  vary  themagnitude or amplitude of the noise by tuning the variance parameter.  By analogy with the two-dimensional scenario, where we observed that different types of relationship between the niche axes(complementary or essential) lead to more noise in specific regions of the kernel, here we considerthree  cases:  noise  can  be  stronger  between  species  with  small  x-niche  differences,  large  x-nichedifferences, or irrespective of x-niche differences.  We call these core noise, tail noise, and uniformnoise, in reference to the part of the kernel where most of the noise is concentrated.  We achievethese different cases by allowing the variance of the noise to depend on distancesdijon the x-nicheaxis  (see  Fig.   S3B-D  for  visual  representations  of  each).   Because  a  noisy  kernel  is  unique,  wesimulated 100 replicates (runs) for each noise type and magnitude to ensure robust results.We impose nonnegative competition coefficients between all species pairs, and positive intraspe-cific competition for all species in order to ensure self-regulation and thus avoid unchecked growth.(If  the  noise  term  brings  the  coefficient  below  zero,  we  set  it  to  zero  if  off-diagonal,  or  redrawit  otherwise.)   Once  all  competition  coefficients  are  drawn  we  rescale  the  matrix  by  its  mean,A→μAA/A,  in  order  to  ensure  that  the  average  competitive  impact  between  species  pairs  isthe same across runs and scenarios.  The rescaled meanμAaffects final community size.  We useμA= 0.2, which combined with our other parameter choices leads to community sizes between 600and 35,000 individuals, depending on the noise scenario and magnitude.  We use a circular nicheaxis to avoid edge effects.  This isolates the contribution of niche differences to pattern (furthertesting revealed this assumption is not critical for the validity of our results).Fig. S3 shows examples of kernels and simulation outcomes in each case.  When there is no noise,the kernel is perfectly monotonic on x-niche distances (Fig. S3A), and the resulting community isvisibly clustered (Fig. S3E). As process noise is added in the form of core, tail, and uniform noise,the kernel lose monotonicity in the respective region while retaining a statistical trend (Fig. S3B-D).  The  resulting  communities,  despite  the  noise,  are  still  clustered,  albeit  less  distinctively  so(Fig. S3F-H). Notice the parallels between core (tail) noise in this generalized process noise modeland complementary (essential) niche axes in the two-dimensional model (cf.  Fig. S3 and Fig. 3 inthe main text).The probability of clustering decreases as the noise increases (Fig. S4).  For the same degreeof overall monotonic relationship between competition and x-niche differences, core noise seems todegrade pattern the most, and tail noise the least, with uniform noise in between (cf.  blue, red, andgreen curves in Fig. S4A). Again, this is similar to what we observed in the two-dimensional caseregarding complementary and essential niche axes.  The core-tail structure predicts the probabilityof  clustering  consistently,  whether  the  noise  is  in  the  core,  tail,  or  across  the  kernel  (Fig.  S4B).This is also similar to our observations for the two-dimensional model (cf.  Fig. S4 and Fig. 4 inthe main text).The similarity between the results of our two-dimensional niche model and our generalized noisemodel indicates that higher niche dimensions add no qualitatively new phenomena to pattern alonga single niche axis.  The fact that uniform noise shows intermediate behavior between core and tailnoise suggests that process noise originating from a combination of complementary and essential10“hidden” niche axes will produce intermediate effects between strictly complementary and strictlyessential niche axes.Figure S3: Generalized process noise.A-D:  Competition  coefficients  between  a  focal  species  nearthe  center  of  the  niche  axis  and  all  other  species,  plotted  against  niche  difference  between  them.   In  thenoise-free case (A), the kernel peaks at zero niche difference and decreases monotonically with absolute nichedifferences.  In the noise scenarios the noise is concentrated in the core (B), tail (C), or uniform across thekernel  (D).  All  kernels  have  the  same  average,A=S−2∑ijAij=  0.2.   Legend  numbers  show  the  noisescores according to each of our two metrics, namely Spearman’sρandπ(A) (see main text).E-H: Speciesabundance plotted against niche values.  (y-axis clipped atN= 15 to emphasize abundance structure in thegaps between high-abundance species.)  Clusters are quite distinctive in the noise-free scenario (E). In thenoisy scenarios (F-H) the pattern is less regular but clustering still occurs—all examples shown are significantat statistical levelp≤0.01.  Legend shows the estimated number of clusters and the z-score of the clusteringstatistic.llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.20.40.60.81.0Noise−freedtraitA[, 100]Aρ = −1.00π = −1.000.00.20.40.60.81.0051015traitNEK = 7Z = 10.7 **llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.51.01.52.0Core noisedtraitA[, 100]Bρ = −0.99π = −0.960.00.20.40.60.81.0051015traitNFK = 8Z = 3.7 **llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.51.01.52.02.5Tail noisedtraitA[, 100]Cρ = −0.38π = −0.750.00.20.40.60.81.0051015traitNGK = 8Z = 3.7 **llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.4−0.20.00.20.40.00.20.40.60.81.01.2General noisedtraitA[, 100]Dρ = −0.55π = −0.780.00.20.40.60.81.0051015traitNHK = 8Z = 3.7 **Species niche valueAbundanceKernel11Figure S4: Probability of clustering by magnitude of noise. The probability of clustering is estimatedas the percentage of runs of each noise scenario where clustering was statistically significant (p≤0.05), outof a total 100 replicates each.  The noise is measured as the degree of randomness between the kernel and thex-niche axis (process noise) or the trait axis (measurement noise), using two indices:A: Monotonic decline ofcompetition with species differences, measured with Spearman’s rank correlation coefficientρ.B: Core-tailstructure, defined as the difference between the proportion of tail and core elements that exceed the kernelmean.  Scenarios shown are process noise with complementary niche axes (blue curves), process noise withessential niche axes (red), and measurement noise (black).  Compare with Fig. 3 in the main text.−1.0−0.8−0.6−0.4−0.20.0020406080100pSpearman's ρ(A, d)A−1.0−0.8−0.6−0.4−0.20.0020406080100pP(Atail>A)−P(Acore>A)BCore noiseTail noiseGeneral noise% Runs with significant clusteringE  Estimating the niche value through multiple proxy traitsIn the main text we wrotetai=baxi+ca+εai,(11)wheretaiis  speciesi’s  trait  value  on  trait  axisa,xiis  speciesi’s  niche  strategy,baandcaareconstants, andεaiis the measurement noise.  Written this way, it looks like we are assuming theniche causes the trait.  However, this is not so.In  general,  speciesi’s  niche  strategy  along  a  niche  axis  will  be  a  function  of  its  trait  valuesalongnfunctional trait axes:xi=f(T1i,T2i,...,Tni).  Our example in the main text correspondsto the particular case where that function is linear in all of the trait values,xi=k0+∑nj=1kjTji.This expression can be easily inverted to write the species trait along a given trait axis as a linearfunction of its niche strategy and all other trait values:Tai= 1/kaxi−k0/ka−∑j6=akj/kaTji.  Thismakes it clear that the measurement errorεaibetween trait axisaand the niche axis in Eq. 11 standsfor the combined contribution of the unmeasured trait axes.  Assuming no correlation between traitvalues along different trait axes, we can find a linear transformation ofTaithat recovers Eq. 11,with Meani(εai) = 0 and Vari(εai) =σ2a.  Parameterσareflects the amplitude of the noise betweentrait axisaand the niche axisx.  This noise amplitude will be small when the contribution of theunmeasured traits is small.In the main text we assume furthermore that the noise is normally distributed, unbiased, anduncorrelated.  In other words,εai∼N(0,σa), cov(xi,εai) = 0, and cov(εai,εbj) = 1 ifi=janda=b,and 0 otherwise.  In these circumstances, the first principal component of such a set of proxy traitswill typically predict species niche values better than most proxy traits individually.  An exampleis shown in Fig. S5.Consider the special case where the expected value of each trait is the true niche value (ba= 1andca=  0,  for  eacha=  1,2,...,L).   The  coefficient  of  determination  between  the  niche  axis12and trait axisais defined asR2x,a=cov2(x,ta)σ2xσ2a,  whereσ2x,σ2a,  and cov(x,ta) are respectively thevariance  in  niche  values,  variance  in  trait  values,  and  covariance  between  niche  and  trait  valuesacross species.  Substituting we getR2x,a=cov2(x,x+εa)σ2xσ2a=cov2(x,x)σ2x(σ2x+σ2a)=σ2xσ2x+σ2aWe define a species’ consensus traitzias the average across its proxy traits:zi= 1/L∑atai=xi+∑aεai/L=xi+εai.  It is also a random variable whose expected value is the true niche value,with  the  advantage  that  it  has  a  lower-magnitude  error:εai∼N(0,√σ2a/L).   By  analogy  withthe calculation above, theR2between the niche values and the consensus trait isR2x,z=σ2xσ2x+σ2a/L.Therefore  the  consensus  trait  will  have  a  higherR2against  the  niche  axis  than  a  given  traittaifσ2a/L < σ2a.   If  all  traits  have  the  same  noise  amplitude,  thenσ2a=σ2aand  the  condition  istrivially met for any number of trait axesL >1.  When the noise amplitudes differ across traits,the consensus trait will still have a higher coefficient of determination that then “typical” trait withnoise amplitudeσ2a.In the more general case wherebaandcadiffer across proxy traits, the first principal componentreplaces the simple trait average as the best predictor of the niche value.  In Fig. S5 we show resultsfor an example with 8 proxy traits where the constantsbaandcawere respectively drawn from anormal distribution centered at 1 and 0:ba∼N(1,σb),ca∼N(0,σc).  We usedσb=σc= 0.5.The amplitude of the measurement noiseσafor each trait was drawn from a uniform distributionbetween 0.05 and 0.25.In the example shown in Fig. S5, most trait axes fail to reveal the existing clustering patternalong the niche axis, even those with highR2(Trait 7 and Trait 8).  In contrast, the first principalcomponent is clustered (clustering z-score = 3.0, p-value<0.01). Note that in this example the firstprincipal component is a better predictor of the niche than seven of the eight traits (R2= 0.94),but is a poorer predictor than Trait 1, which is tightly linked to the niche (R2= 0.99) and is theonly clustered trait (z-score = 3.3, p-value<0.01).  In general, the first principal component willtypically have a higher coefficient of determination with the niche axis than individual trait axes,and is also more likely to be clustered.13Figure S5:Example showing relationship between the trait value of each species (x-axis) and the nichevalue (y-axis) for 8 proxy traits that predict the niche value with varying degrees of precision, plus the firstprincipal component (ninth panel).  The legend in each panel shows the coefficient of determination betweenthe  niche  and  trait  valuesR2,  the  estimated  number  of  species  clusters  along  that  trait  axis  K,  and  theclustering z-score Z, with the number of stars indicating significance (2 stars forp≤0.01, 1 star forp≤0.05,zero stars forp >0.05).llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll0.51.01.52.02.50.00.20.40.60.81.0Trait 1meas[, j]traitK = 7Z = 3.3 **R2 = 0.97llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.8−0.7−0.6−0.5−0.40.00.20.40.60.81.0Trait 2meas[, j]traitK = 9Z = 0.2 R2 = 0.04llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−1.0−0.50.00.50.00.20.40.60.81.0Trait 3meas[, j]traitK = 11Z = 0.5 R2 = 0.38llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll0.51.01.52.02.50.00.20.40.60.81.0Trait 4meas[, j]traitK = 7Z = −0.2 R2 = 0.59llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.6−0.4−0.20.00.20.40.00.20.40.60.81.0Trait 5meas[, j]traitK = 19Z = −0.1 R2 = 0.34llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.50.00.51.00.00.20.40.60.81.0Trait 6meas[, j]traitK = 5Z = −0.2 R2 = 0.57llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−0.8−0.40.00.20.40.00.20.40.60.81.0Trait 7meas[, j]traitK = 18Z = −0.5 R2 = 0.89llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll−1.00.00.51.01.52.00.00.20.40.60.81.0Trait 8meas[, j]traitK = 13Z = −0.2 R2 = 0.85llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll0.20.40.60.81.01.21.40.00.20.40.60.81.0First principal componentpctraitK = 7Z = 3.0 **R2 = 0.94Trait valueNiche valueF  Clustering metric — the gap statistic via k-means clusteringHere we describe a metric to identify and quantify clustering between species on a niche or traitaxis2, based on a method developed by Tibshirani et al. (2001).  The metric receives as input thespecies abundances and their niche (trait) values, and then estimates the number of clusters thatbest fits the data.  It also provides an index—the gap statistic—that quantifies the degree to whichthe species assemblage fits that number of clusters better than a set of reference (null) assemblages.For each candidate number of clusterskwithin a provided range [kmin,kmax], we calculate thegoodness of fit ofkclusters to our species assemblage,fk, as well as the goodness of fit ofkclustersto  each  of  the  null  assemblages ̃fk,i,  wherei=  1,2,...,NnullsandNnullsis  the  total  number  of2The method also applies in general to a niche or trait space with any number of dimensions, as long as that spaceallows a meaningful definition of “distance” between species—such as Euclidean distance.14null assemblages.  We then record the difference (the gap) between the former and the average ofthe latter:  ∆k=fk− ̃fk.  The estimated number of clustersˆkis thekthat maximizes the gap,∆ˆk= maxk(∆k), and the maximum gap itself is the gap statistic,Gap= ∆ˆk.The method is quite general, and both the null assemblages and the measure of goodness of fitmust be specified.  We generate our null assemblages by shuffling abundances among species, i.e.we randomly redistribute observed species abundances to observed niche (trait) values.  This keepsboth the set of abundances and the set of traits, while randomizing the map between them.As  for  the  goodness  of  fit,  following  (Tibshirani  et  al.,  2001)  we  use  the  k-means  clusteringalgorithm  (see  MacQueen  1967).   This  method  partitions  individuals  into  a  specified  number  ofgroups such that the so-called dispersion between individuals within the same group is minimized.LetDrbe the total pairwise squared distance between members of groupr, that is,Dr=∑i,j(xi−xj)2,  wherexiis the niche or trait value of individuali.  The dispersionWkis then the sum ofthose numbers across allkgroups,Wk=∑kr=1Dr.  The k-means algorithm consists in assigningeach individual to one of thekgroups so thatWkis as low as possible3,4.We then setfk= log(1/Wk) as the goodness of fit, and feed it into the gap statistic algorithm toestimate the number of clustersk.  Notice that it does not make sense to compare the goodness of fitfkdirectly across differentks becausefknecessarily increases withk, as the average within-clusterdistance is always lower for higher numbers of clusters.  By comparing against null assemblages, thegap method finds the biggest increase in goodness of fitbeyondwhat is expected from the increaseink.  The reason we use log(1/Wk) rather than simply 1/Wkis that the expected increments in1/Wkwith increasingkare multiplicative rather than additive.  See (Tibshirani et al., 2001) formore details.  Our metric is then defined asGap= maxk(log(1/Wk)−log(1/ ̃Wk)), and the value ofkat which the quantity in the parenthesis is maximal is the estimated number of clustersˆk.If we knew the expected distribution of this statistic under the null hypothesis where speciesniches (traits) and abundances are unrelated to each other, we could stop here, as the value ofGapwould tell us about both degree of clustering and statistical significance.  Because we do not knowthat distribtution, we must compare it with a null set of values.  We therefore calculate the metricon each of our null assemblages, and from that we obtain a z-score and a p-value.  Those are definedasz= (Gap− ̃Gap)/σ( ̃Gap) andp=1Nnulls∑Nnullsi=1I( ̃Gapi≥Gap) where ̃Gapiis the gap statisticobtained for thei-th null assemblage, ̃Gapandσ( ̃Gap) are the mean and standard deviation acrossthose  values,  andIis  the  index  function,  equal  to  1  if  its  argument  is  true  and  zero  otherwise.The z-score and p-value quantify respectively the degree to which the gap statistic returned by ourspecies assemblage exceeds null expectations, and whether that result is statistically significant.G  Kernel structure in the trait-noise scenarioIn the trait-noise scenario, the competition coefficients plotted against proxy trait values resemblethe core-noise kernel, with most of the noise occurring for pairs with small trait difference (compare3Dispersion can be defined in different ways, depending on how one wishes to weigh the number of members pergroup.  While Tibshirani et al. (2001) choose to scale the squared distances by the number of individuals in the group,Yan  and  Ye  (2007)  argue  that  scaling  it  by  the  number  of  pairs  in  the  group  is  a  a  better  choice  in  some  cases.In our study we saw no qualitative difference between those different scaling options, and opted to use the simplerunweighted sum of squared distances.4In our model, all conspecific individuals have the same niche (trait) value, and therefore necessarily belong inthe same cluster.  Species are therefore trivial clusters of individuals.  Ecologists are of course interested in clusteringbeyond the obvious grouping of individuals into species.15Figs. 3A and 5H in the main text). However, a closer look reveals that the measurement-noise kernelis more structured (Fig. S6):  unlike the core-noise scenario, the matrix is symmetric and the noiseis autocorrelated.  We note that there is a permutation of the rows and columns of the competitionmatrix in the trait noise scenario that restores the noise-free matrix.  This is not the case with anyof the kernel noise scenarios presented in the main text.Figure S6:Comparison between the competition kernel from the core-noise scenario and the trait-noisescenario.Left:  Core-noise  competition  coefficients  between  species  pairs  plotted  against  their  respectiveniche values, with darker shades of gray representing stronger competition.  Coefficients tend to be higherwhen species have similar niche values (the top-left and bottom-right corners are continuations of the diag-onal, as the niche axis is circular).  The noise is manifested in the fine-grained pixelation of the grey band,and lacks any visible structure.Right:  Trait-noise competition coefficients plotted against trait values.  Asin  the  core-noise  scenario,  the  noise  is  concentrated  in  the  diagonal  band  where  competition  is  stronger.However, unlike the core-noise scenario, the matrix is symmetric and the pixel sizes are larger, indicatingautocorrelation in the noise.0.20.40.60.80.20.40.60.8Niche valueNiche value0.00.20.40.60.81.00.00.20.40.60.81.0Proxy traitProxy traitCore noiseTrait noiseReferencesAbrams,  P.  (1980).   Are  Competition  Coefficients  Constant?   Inductive  Versus  Deductive  Ap-proaches.The American Naturalist, 116(5):730–735.Craine, J. M. and Jackson, R. D. (2010).  Plant nitrogen and phosphorus limitation in 98 NorthAmerican grassland soils.Plant and Soil, 334(1):73–84.Danger, M., Daufresne, T., Lucas, F., Pissard, S., and Lacroix, G. (2008). Does Liebig’s law of theminimum scale up from species to communities?Oikos, 117(11):1741–1751.Harpole, W. S., Ngai, J. T., Cleland, E. E., Seabloom, E. W., Borer, E. T., Bracken, M. E., Elser,J. J., Gruner, D. S., Hillebrand, H., Shurin, J. B., and Smith, J. E. (2011). Nutrient co-limitationof primary producer communities.Ecology Letters, 14(9):852–862.16Huber, S. K. and Podos, J. (2006).  Beak morphology and song features covary in a population ofDarwin’s finches (Geospiza fortis).Biological Journal of the Linnean Society, 88(3):489–498.MacArthur, R. H. (1972).Geographical ecology; patterns in the distribution of species.  Harper &Row.MacArthur, R. H. and Levins, R. (1967). The Limiting Similarity, Convergence, and Divergence ofCoexisting Species.The American Naturalist, 101(921):377–385.MacQueen, J. B. (1967). Some Methods for classification and Analysis of Multivariate Observations.5th Berkeley Symposium on Mathematical Statistics and Probability 1967, 1(233):281–297.Saito, M. A., Goepfert, T. J., and Ritt, J. T. (2008). Some thoughts on the concept of colimitation:Three definitions and the importance of bioavailability.Limnology and Oceanography, 53(1):276–290.Schluter, D. and Grant, P. R. (1984).  Determinants of Morphological Patterns in Communities ofDarwin’s Finches.The American Naturalist, 123(2):175–196.Schoener,  T.  W.  (1974).   Resource  partitioning  in  ecological  communities.Science (New York,N.Y.), 185(4145):27–39.Schoener, T. W. (1976).  Alternatives to Lotka-Volterra competition:  models of intermediate com-plexity.Theoretical population biology, 10(3):309–33.Tibshirani, R., Walther, G., and Hastie, T. (2001). Estimating the number of clusters in a data setvia the gap statistic.Journal of the Royal Statistical Society: Series B (Statistical Methodology),63:411–423.Yan, M. and Ye, K. (2007).  Determining the number of clusters using the weighted gap statistic.Biometrics, 63(4):1031–1037.17